<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DevOps Real App</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 40px auto; padding: 0 16px; }
    header { display: flex; align-items: center; gap: 12px; }
    h1 { margin: 0; }
    section { margin: 24px 0; padding: 16px; border: 1px solid #eee; border-radius: 12px; }
    label { display:block; margin: 8px 0 4px; }
    input, select, textarea { width: 100%; padding: 10px; border:1px solid #ddd; border-radius:8px; }
    button { padding: 10px 16px; border: 0; border-radius: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>DevOps Real App</h1>
    <small id="health">Checking health…</small>
  </header>

  <section>
    <h2>Live Crypto Quotes</h2>
    <p><button id="btnQuotes">Get BTC/ETH USD</button></p>
    <pre id="quotesOut">Click the button…</pre>
  </section>

  <section>
    <h2>Create a Lead</h2>
    <p><em>Note: this requires MongoDB to be connected. If your DB isn’t connected yet, this will fail.</em></p>
    <form id="leadForm">
      <label>Name</label>
      <input name="name" placeholder="Ngozi" required />
      <label>Phone/WhatsApp</label>
      <input name="phone" placeholder="+2348012345678" required />
      <label>Service</label>
      <select name="service" required>
        <option value="crypto">Crypto</option>
        <option value="giftcard">Giftcard</option>
        <option value="webdev">Web Dev</option>
        <option value="seo">SEO</option>
      </select>
      <label>Note</label>
      <textarea name="note" rows="3" placeholder="Buy BTC 200 USDT"></textarea>
      <p><button type="submit">Submit Lead</button></p>
    </form>
    <pre id="leadOut">Awaiting submission…</pre>
  </section>

  <script>
    const out = (el, data) => el.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);

    // Health check
    fetch('/health')
      .then(r => r.json()).then(j => (document.getElementById('health').textContent = 'Status: ' + j.status))
      .catch(() => (document.getElementById('health').textContent = 'Status: unreachable'));

    // Quotes
    document.getElementById('btnQuotes').onclick = async () => {
      const el = document.getElementById('quotesOut');
      out(el, 'Loading…');
      try {
        const r = await fetch('/quotes');
        out(el, await r.json());
      } catch (e) {
        out(el, { error: e.message });
      }
    };

    // Lead submission
    document.getElementById('leadForm').onsubmit = async (e) => {
      e.preventDefault();
      const el = document.getElementById('leadOut');
      out(el, 'Submitting…');
      const form = new FormData(e.target);
      const payload = Object.fromEntries(form.entries());
      try {
        const r = await fetch('/leads', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await r.json();
        out(el, data);
      } catch (e2) {
        out(el, { error: e2.message });
      }
    };
  </script>
</body>
</html>
